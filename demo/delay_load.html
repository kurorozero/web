<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>延时加载</title>
<style type="text/css">
body,div,ul,li{margin:0;padding:0;}
#box{width:770px;margin:0 auto;padding:10px 0 0 10px;background:#f00;overflow:hidden;zoom:1;}
#box li{float:left;width:375px;height:225px;color:#fff;padding:10px 0;display:inline;text-align:center;margin:0 10px 10px 0;background:#000 url(http://js.fgm.cc/learn/lesson10/img/lazy/loading.gif) 50% 50% no-repeat;}
#box textarea{display:none;}
</style>
</head>
<script type="text/javascript">
//延时加载
function LazyLoad ()
{
	this.initialize.apply(this, arguments)	
}
LazyLoad.prototype = 
{
	initialize: function (obj)
	{
		var _this = this;
		this.lazy = typeof obj === "string" ? document.getElementById(obj) : obj;
		this._load = function () {return _this.load.apply(_this, arguments)};		
		this.load();
		this.addEvent(window, "scroll", this._load);
		this.addEvent(window, "resize", this._load);
	},
	pageX: function (element)
	{
		return element.offsetLeft + (element.offsetParent ? arguments.callee(element.offsetParent) : 0)
	},
	pageY: function (element)
	{
		return element.offsetTop + (element.offsetParent ? arguments.callee(element.offsetParent) : 0)	
	},
	addEvent: function (element, type, handler)
	{
		return element.addEventListener ? element.addEventListener(type, handler, false) : element.attachEvent("on" + type, handler)
	},
	load: function ()
	{
		var aTextArea = this.lazy.getElementsByTagName("textarea");		
		var iScrollTop = (document.documentElement.scrollTop || document.body.scrollTop);
		var iClientHeight = document.documentElement.clientHeight + iScrollTop;
		var i = 0;
		var aParent = [];
		if (!aTextArea[0]) return;	
		for (i = 0; i < aTextArea.length; i++)
		{
			var oParent = aTextArea[i].parentElement || aTextArea[i].parentNode;
			var iTop = this.pageY(oParent);
			var iBottom = iTop + oParent.offsetHeight;			
			if ((iTop > iScrollTop && iTop < iClientHeight) || (iBottom > iScrollTop && iBottom < iClientHeight))
			aParent.push(oParent)
		}
		for (i = 0; i < aParent.length; i++)
		aParent[i].innerHTML = aParent[i].getElementsByTagName("textarea")[0].value;
	}
};

//应用
window.onload = function ()
{
	var oLazy = document.getElementById("box");
	new LazyLoad(oLazy);
};
</script>
<body>
<ul id="box">
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/1.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/2.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/3.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/4.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/5.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/6.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/7.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/8.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/9.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/10.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/11.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/12.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/13.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/14.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/15.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/16.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/17.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/18.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/19.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/20.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/21.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/22.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/23.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/24.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/25.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/26.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/27.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/28.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/29.jpg" /></textarea></li>
    <li><textarea><img src="http://js.fgm.cc/learn/lesson10/img/lazy/30.jpg" /></textarea></li>
</ul>
</body>
</html>